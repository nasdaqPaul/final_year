<!DOCTYPE html>
<html>
<head>
    <!--Import Google Icon Font-->
    <title>{{ title or 'Final Year' }}</title>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    {#        <link type="text/css" rel="stylesheet" href="{{ url_for ('web.static', filename='simditor/styles/app.css') }}">#}
    <link type="text/css" rel="stylesheet" href="{{ url_for ('web.static', filename='simditor/styles/simditor.css') }}">
    <!--Import materialize.css-->
    <link type="text/css" rel="stylesheet" href="{{ url_for ('.static', filename='css/materialize.css') }}"
          media="screen,projection"/>
    <link type="text/css" rel="stylesheet" href="{{ url_for ('web.static', filename='css/style.css') }}">
    <!--Let browser know website is optimized for mobile-->
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
</head>

<body>
<header>
    <nav>
        <div class="nav-wrapper ">
            <a href="#" class="brand-logo">FinalYear</a>
            <ul id="nav-mobile" class="right hide-on-med-and-down">
                <li><a href="/logout"><i class="material-icons right">account_circle</i>Log Out</a></li>
            </ul>
            <a href="#" data-target="slide-out" class="sidenav-trigger"><i class="material-icons">menu</i></a>
        </div>
    </nav>
</header>

<ul id="slide-out" class="sidenav sidenav-fixed invisible grey lighten-3">
    <li>
        <div class="user-view ">
            {#                <div class="background grey">#}
            {#                  <img src="https://picsum.photos/seed/picsum/200/300">#}
            {#                </div>#}
            <a href="#user"><img class="circle" src="https://picsum.photos/id/237/200/300"></a>
            <a href="#name"><span
                    class="name">{{ current_user.first_name + " " + current_user.last_name }}</span></a>
            {#                <p>{{ current_user.department.name }}<br/><span class="red-text">{{ current_user.role }}</span></p>#}
        </div>
    </li>
    <li>
        <div class="divider"></div>
    </li>
    <li><a class="subheader">Actions</a></li>

    <li class="active"><a href="/create_event"><i class="material-icons">event</i>Create new event</a></li>
    <li><a href="/create_announcement"><i class="material-icons">announcement</i>Create new announcement</a></li>
    <li>
        <div class="divider"></div>
    </li>
    <li><a class="subheader">Subheader</a></li>
    <li><a class="waves-effect" href="#!">Third Link With Waves</a></li>

</ul>
<main>
    <form method="post" id="event_form">
        <section>
            <h1 class="center-align">Create Event</h1>

            {{ form.hidden_tag() }}
            <div class="row">
                <div class="input-field col s12 m6">
                    <i class="material-icons prefix">add</i>
                    {{ form.event_name(id='event_name') }}
                    {{ form.event_name.label }}
                </div>
                <div class="input-field col s12 m6">
                    <i class="material-icons prefix">location_on</i>
                    {{ form.venue(id='venue') }}
                    {{ form.venue.label }}
                </div>
            </div>

            <div class="row">
                {{ form.description(id = "editor") }}
            </div>
            <div class="row">
                <div class="input-field col s12 m4">
                    <i class="material-icons prefix">event</i>
                    {{ form.date(class='datepicker', id='date') }}
                    {{ form.date.label }}
                </div>
                <div class="input-field col s3 m4">
                    <i class="material-icons prefix">access_time</i>
                    {{ form.start_time(class='timepicker', id='start_time') }}
                    {{ form.start_time.label }}
                </div>
                <div class="input-field col s3 m4">
                    <i class="material-icons prefix">access_time</i>
                    {{ form.end_time(class='timepicker', id='end_time') }}
                    {{ form.end_time.label }}
                </div>
            </div>
        </section>
    </form>
    <hr>
    <ul class="pagination center">
        <li class="disabled"><a href="#!"><i class="material-icons">chevron_left</i></a></li>
        <li class="active"><a href="#!">Edit</a></li>
        <li class="waves-effect" id="rep"><a>Recipients</a></li>
        <li class="disabled"><a href="#!">Send</a></li>
        <li class="waves-effect"><a href="#!"><i class="material-icons">chevron_right</i></a></li>
    </ul>
</main>

<!--JavaScript at end of body for optimized loading-->
<script type="text/javascript" src="{{ url_for('.static', filename='js/jQuery.js') }}"></script>
<script type="text/javascript" src="{{ url_for('.static', filename='js/materialize.js') }}"></script>
<script type="text/javascript" src="{{ url_for('.static', filename='simditor/scripts/module.js') }}"></script>
<script type="text/javascript" src="{{ url_for('.static', filename='simditor/scripts/uploader.js') }}"></script>
<script type="text/javascript" src="{{ url_for('.static', filename='simditor/scripts/hotkeys.js') }}"></script>
<script type="text/javascript" src="{{ url_for('.static', filename='simditor/scripts/simditor.js') }}"></script>

<script>
    {% with messages=get_flashed_messages() %}
        {% if messages %}
            {% for message in messages %}
                M.toast({html: '{{ message }}'});
            {% endfor %}
        {% endif %}
    {% endwith %}

    $(document).ready(function () {
        $("#event_form :input, #editor").change(function () {
            $('#event_form').data('changed', true);
        });
        const event_name = document.getElementById('event_name');
        const event_date = document.getElementById('date');
        const start_time = document.getElementById('start_time');
        const end_time = document.getElementById('end_time');
        const content = document.getElementById('editor');
        const event_venue = document.getElementById(('venue'));

        // Initialize time and date picker
        M.Datepicker.init(event_date, {
            minDate: new Date()
        });
        M.Timepicker.init(document.querySelectorAll('.timepicker'), {});
        // Initialize the sidebars
        $('.sidenav').sidenav();
        Simditor.locale = 'en-US';
        const editor = new Simditor({
            textarea: $('#editor'),
            toolbar: [
                'title',
                'bold',
                'italic',
                'underline',
                'strikethrough',
                'fontScale',
                'color',
                'ol',
                'ul',
                'blockquote',
                'code',
                'table',
                'link',
                'image',
                'hr',
                'indent',
                'outdent',
                'alignment',
            ],
            allowedTags: ['br', 'span', 'a', 'img', 'b', 'strong', 'i', 'strike', 'u', 'font', 'p', 'ul', 'ol', 'li', 'blockquote', 'pre', 'code', 'h1', 'h2', 'h3', 'h4', 'hr']
        });
        editor.on('valuechanged', function (e, src) {
            if ($('#event_form').data('changed')){
                return;
            }
            else {
                $('#event_form').data('changed', true);
            }
        });

        // Event listener for clicking the recipients link
        $('#rep').click(function () {
            // Validate pass 1: Check for empty string
            if (event_name.value.trim() == '') {
                M.toast({
                    html: "<strong>Event Name must be filled</strong>",
                    displayLength: 2000,
                    classes: "teal white-text rounded"
                });
                event_name.focus();
                return;
            }
            if (event_venue.value.trim() == '') {
                M.toast({
                    html: '<strong>Event Venue cannot be empty</strong>',
                    displayLength: 2000,
                    classes: "teal white-text rounded"
                });
                event_venue.focus();
                return;
            }
            if (event_date.value == '') {
                M.toast({
                    html: "<strong>Event Date must be filled</strong>",
                    displayLength: 2000,
                    classes: "teal white-text rounded"
                });
                M.Datepicker.getInstance(event_date).open();
                return;
            }
            if (start_time.value.trim() == '') {
                M.toast({
                    html: '<strong>Start time must be filled</strong>',
                    displayLength: 2000,
                    classes: "teal white-text rounded"
                });
                M.Timepicker.getInstance(start_time).open();
                return;
            }
            if (end_time.value.trim() == '') {
                M.toast({
                    html: '<strong>End time must be filled</strong>',
                    displayLength: 2000,
                    classes: "teal white-text rounded"
                });
                M.Timepicker.getInstance(end_time).open();
                return;
            }
            if (content.value.trim() == '') {
                M.toast({html: "No content"});
                editor.focus();
                return;
            }
            // Validate pass 2: Check formats of date and time
            // TODO

            $('#event_form').attr('action', '/save_event/event_recipient');
            $('#event_form').submit();

        });
    });
</script>
</body>
</html>